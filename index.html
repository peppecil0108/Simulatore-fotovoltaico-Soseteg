<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8"/>
<title>Simulatore Fotovoltaico ‚Äì Demo Commerciale</title>
<meta name="viewport" content="width=device-width,initial-scale=1"/>

<style>
body {
 font-family: Arial, sans-serif;
 margin:12px;
 background:#f4f6f8;
 color:#222;
}
h2 { text-align:center; }
.step { display:none; }
.step.active { display:block; }

button {
 padding:12px;
 width:100%;
 margin-top:12px;
 cursor:pointer;
 background:#2e7d32;
 color:#fff;
 border:none;
 border-radius:6px;
 font-size:1rem;
}
button.secondary {
 background:#546e7a;
}

label { font-weight:600; margin-top:10px; display:block; }
input, select {
 padding:8px;
 width:100%;
 border-radius:4px;
 border:1px solid #ccc;
}

.box {
 background:#fff;
 border-radius:8px;
 padding:16px;
 margin-top:14px;
 box-shadow:0 2px 8px rgba(0,0,0,.06);
}

.box h4 {
 margin-top:0;
 border-bottom:1px solid #eee;
 padding-bottom:6px;
}

.calc {
 font-size:0.9rem;
 background:#f1f5f9;
 padding:12px;
 border-radius:6px;
 line-height:1.5;
}

.disclaimer {
 font-size:0.75rem;
 color:#555;
 margin-top:20px;
 background:#fff3cd;
 padding:10px;
 border-radius:6px;
}

@media(min-width:768px){
 body { max-width:760px; margin:auto; }
}
</style>
</head>

<body>

<h2>‚òÄÔ∏è Simulatore Fotovoltaico</h2>
<p style="text-align:center"><strong>Demo commerciale ‚Äì calcoli trasparenti</strong></p>

<!-- STEP 1 -->
<div class="step active" id="step1">
<div class="box">
<h4>1Ô∏è‚É£ Abitazione</h4>

<label>Numero persone</label>
<input type="number" id="people" value="3" min="1">

<label>Superficie tetto disponibile (m¬≤)</label>
<input type="number" id="roof" value="50">

<button onclick="goStep(2)">Continua</button>
</div>
</div>

<!-- STEP 2 -->
<div class="step" id="step2">
<div class="box">
<h4>2Ô∏è‚É£ Impianto</h4>

<label>Potenza pannello (W)</label>
<select id="panelW">
<option value="400">400</option>
<option value="450">450</option>
<option value="500">500</option>
</select>

<label>Inclinazione pannelli (¬∞)</label>
<input type="number" id="tilt" value="30">

<label>Batteria singola (kWh)</label>
<select id="battery">
<option value="5">5</option>
<option value="7">7</option>
<option value="10">10</option>
</select>

<button onclick="calculate()">Calcola simulazione</button>
</div>
</div>

<!-- STEP 3 -->
<div class="step" id="step3">

<div class="box">
<h4>üìä Impianto consigliato</h4>
<div>Pannelli: <b><span id="panels"></span></b></div>
<div>Potenza totale: <b><span id="kwp"></span></b></div>
<div>Produzione annua: <b><span id="prod"></span></b></div>
<div>Copertura tetto: <b><span id="areaPerc"></span></b></div>
</div>

<div class="box">
<h4>üîã Accumulo</h4>
<div>Batterie: <b><span id="battNum"></span></b></div>
<div>Capacit√† totale: <b><span id="battCap"></span></b></div>
</div>

<div class="box">
<h4>üí∞ Risparmio</h4>
<div>Risparmio annuo stimato: <b><span id="saveEuro"></span></b></div>
<div>Rientro investimento: <b><span id="payback"></span></b></div>
</div>

<div class="box">
<h4>üìå Calcoli dettagliati</h4>
<div class="calc" id="calcBox"></div>
</div>

<button class="secondary" onclick="window.print()">üìÑ Scarica preventivo PDF</button>
<button onclick="goStep(1)">Nuova simulazione</button>

<div class="disclaimer">
‚ö†Ô∏è <b>Disclaimer</b><br>
Le stime fornite hanno valore puramente indicativo e non costituiscono offerta commerciale.
I risultati dipendono da orientamento, ombreggiamenti, abitudini di consumo, tariffe e condizioni di installazione.
Per un preventivo definitivo √® necessario un sopralluogo tecnico.
</div>

</div>

<script>
// ===== PARAMETRI =====
const PANEL_AREA = 2;
const SPECIFIC_YIELD = 1200;
const ENERGY_COST = 0.30;
const COST_FV_KWP = 1600;
const COST_BATT_KWH = 800;
const SELF_CONSUMPTION = 0.55;
const MAX_KWP = 10;

// ===== STEP =====
function goStep(n){
 document.querySelectorAll('.step').forEach(s=>s.classList.remove('active'));
 document.getElementById('step'+n).classList.add('active');
}

// ===== CONSUMI =====
function consumoMedio(p){
 if(p<=1) return 1800;
 if(p===2) return 2700;
 if(p===3) return 3600;
 if(p===4) return 4500;
 return 4500 * (1 + 0.15*(p-4));
}

// ===== CALCOLO =====
function calculate(){
 const people = +peopleEl.value;
 const roof = +roofEl.value;
 const panelW = +panelWEl.value;
 const tilt = +tiltEl.value;
 const battSize = +batteryEl.value;

 const usableRoof = roof * 0.8;

 const baseCons = consumoMedio(people);
 const target = baseCons * 1.2;

 const tiltFactor = Math.cos((tilt-30)*Math.PI/180);
 const kwhPanel = panelW/1000 * SPECIFIC_YIELD * tiltFactor;

 let panels = Math.floor(usableRoof / PANEL_AREA);
 panels = Math.min(panels, Math.ceil(target / kwhPanel));

 let kwp = panels * panelW / 1000;
 if(kwp > MAX_KWP){
   kwp = MAX_KWP;
   panels = Math.floor((MAX_KWP*1000)/panelW);
 }

 const production = kwp * SPECIFIC_YIELD * tiltFactor;

 const areaCovered = panels * PANEL_AREA;
 const areaPerc = Math.round(areaCovered / roof * 100);

 const daily = baseCons / 365;
 const night = daily * 0.45;
 const batteryNeeded = night / 0.8;

 let battNum = 1;
 if(batteryNeeded > battSize * 1.2){
   battNum = Math.ceil(batteryNeeded / battSize);
 }
 const battCap = battNum * battSize;

 const savedKwh = Math.min(baseCons, production * SELF_CONSUMPTION);
 const savedEuro = savedKwh * ENERGY_COST;
 const investment = kwp*COST_FV_KWP + battCap*COST_BATT_KWH;
 const payback = investment / savedEuro;

 panelsEl.innerText = panels;
 kwpEl.innerText = kwp.toFixed(2)+" kWp";
 prodEl.innerText = Math.round(production)+" kWh";
 areaPercEl.innerText = `${areaCovered} m¬≤ su ${roof} m¬≤ (${areaPerc}%)`;

 battNumEl.innerText = battNum;
 battCapEl.innerText = battCap+" kWh";

 saveEuroEl.innerText = "‚Ç¨ "+Math.round(savedEuro)+" / anno";
 paybackEl.innerText = payback.toFixed(1)+" anni";

 calcBox.innerHTML = `
Tetto utilizzabile (80%): <b>${usableRoof.toFixed(1)} m¬≤</b><br>
Consumo stimato: <b>${Math.round(baseCons)} kWh/anno</b><br>
Produzione stimata: <b>${Math.round(production)} kWh/anno</b><br>
Autoconsumo stimato: <b>${Math.round(savedKwh)} kWh</b><br>
Costo stimato impianto: <b>‚Ç¨ ${Math.round(investment)}</b>
`;

 goStep(3);
}

// ===== ELEMENTI =====
const peopleEl = document.getElementById("people");
const roofEl = document.getElementById("roof");
const panelWEl = document.getElementById("panelW");
const tiltEl = document.getElementById("tilt");
const batteryEl = document.getElementById("battery");

const panelsEl = document.getElementById("panels");
const kwpEl = document.getElementById("kwp");
const prodEl = document.getElementById("prod");
const areaPercEl = document.getElementById("areaPerc");
const battNumEl = document.getElementById("battNum");
const battCapEl = document.getElementById("battCap");
const saveEuroEl = document.getElementById("saveEuro");
const paybackEl = document.getElementById("payback");
const calcBox = document.getElementById("calcBox");
</script>

</body>
</html>
