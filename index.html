<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8"/>
<title>Simulatore Fotovoltaico</title>
<meta name="viewport" content="width=device-width,initial-scale=1"/>

<style>
body { font-family: Arial, sans-serif; margin:12px; background:#fff; color:#222; }
h2 { text-align:center; }
.step { display:none; }
.step.active { display:block; }

button { padding:12px; width:100%; margin-top:12px; cursor:pointer; background:#2e7d32; color:#fff; border:none; border-radius:6px; font-size:1rem; }
button.secondary { background:#546e7a; }

label { font-weight:600; margin-top:10px; display:block; }
input, select { padding:8px; width:100%; border-radius:4px; border:1px solid #ccc; }

.box { background:#fff; border-radius:8px; padding:16px; margin-top:14px; box-shadow:0 2px 8px rgba(0,0,0,.06); }
.calc { font-size:0.9rem; background:#f1f5f9; padding:14px; border-radius:6px; line-height:1.55; }

@media(min-width:768px){ body { max-width:760px; margin:auto; } }
</style>
</head>

<body>
<br>
<a href="https://www.soseteg.it" target="_blank" style="display: block; text-align: center;">
  <img 
    src="https://static.wixstatic.com/media/02f472_01b47059d90245dca972e74c5e32e821~mv2.webp"
    alt="Logo SOSETEG"
    style="width:130px; height:auto;"
  >
</a>


<h2>‚òÄÔ∏è Simulatore Fotovoltaico SOSETEG SPA </h2>
<p style="text-align:center"><strong>Calcoli completamente visibili</strong></p>

<!-- STEP 1 -->
<div class="step active" id="step1">
<div class="box">
<h4>1Ô∏è‚É£ Abitazione</h4>

<label>Numero persone</label>
<input type="number" id="people" value="3" min="1">

<label>Superficie tetto disponibile (m¬≤)</label>
<input type="number" id="roof" value="50">

<label>Consumo annuo stimato (kWh, opzionale)</label>
<input type="number" id="manualCons" placeholder="Lascia vuoto per calcolo automatico">

<label>Ultima bolletta (‚Ç¨)</label>
<input type="number" id="lastBill" placeholder="Opzionale, per calcolo risparmio realistico">

<button onclick="goStep(2)">Continua</button>
</div>
</div>

<!-- STEP 2 -->
<div class="step" id="step2">
<div class="box">
<h4>2Ô∏è‚É£ Impianto</h4>

<label>Potenza pannello (W)</label>
<select id="panelW">
<option value="400">400</option>
<option value="450">450</option>
<option value="500">500</option>
</select>

<label>Inclinazione pannelli (¬∞)</label>
<input type="number" id="tilt" value="30">

<label>Batteria singola (kWh)</label>
<select id="battery">
<option value="0">Nessuna batteria</option>
<option value="5">5</option>
<option value="7">7</option>
<option value="10">10</option>
</select>
<label>Zona geografica</label>
<select id="zone">
  <option value="nord">Nord Italia</option>
  <option value="centro">Centro Italia</option>
  <option value="sud">Sud Italia</option>
</select>

<button onclick="calculate()">Calcola simulazione</button>
</div>
</div>

<!-- STEP 3 -->
<div class="step" id="step3">

<div id="roofWarningBox" class="box" style="display:none; background:#fff3cd; color:#856404; border:1px solid #ffeeba;">
<!-- qui comparir√† il messaggio di tetto insufficiente -->
</div>


<div class="box">
<h4>üìä Risultato impianto</h4>
<div>Pannelli: <b><span id="panels"></span></b></div>
<div>Area occupata dai pannelli: <b><span id="areaUsed"></span></b></div>
<div>Potenza totale: <b><span id="kwp"></span></b></div>
<div>Produzione annua: <b><span id="prod"></span></b></div>
<div>Copertura tetto: <b><span id="areaPerc"></span></b></div>
</div>

<div class="box">
<h4>üîã Accumulo</h4>
<div>Batterie: <b><span id="battNum"></span></b></div>
<div>Capacit√† totale: <b><span id="battCap"></span></b></div>
</div>

<div class="box">
<h4>üí∞ Risparmio</h4>
<div>Risparmio annuo: <b><span id="saveEuro"></span></b></div>
<div>Rientro investimento: <b><span id="payback"></span></b></div>
</div>

<div class="box">
<h4><em>‚ö†Ô∏è Attenzione: i risultati mostrati hanno valore puramente indicativo. Non costituiscono un‚Äôofferta vincolante n√© una proposta commerciale. Consultare sempre un tecnico qualificato per progettazione e preventivi reali.</em></h4>
</div>



<div class="box">
<h4>üìå Calcoli dettagliati (passo-passo)</h4>
<div class="calc" id="calcBox"></div>
</div>


<button class="secondary" onclick="window.print()">üìÑ Scarica PDF</button>
<button onclick="goStep(1)">Nuova simulazione</button>

</div>

<script>




// PARAMETRI
const PANEL_AREA = 2;
const SPECIFIC_YIELD = 1200;
const ENERGY_COST = 0.30;
const COST_FV_KWP = 1600;
const COST_BATT_KWH = 800;
const SELF_CONSUMPTION = 0.55;
const ZONE_YIELD = {
  nord: 1100,
  centro: 1250,
  sud: 1450
};

// STEP
function goStep(n){
 document.querySelectorAll('.step').forEach(s=>s.classList.remove('active'));
 document.getElementById('step'+n).classList.add('active');
}

// CONSUMI
function consumoMedio(p){
 if(p<=1) return 1800;
 if(p===2) return 2700;
 if(p===3) return 3600;
 if(p===4) return 4500;
 return 4500 * (1 + 0.15*(p-4));
}

// CALCOLO
function calculate(){
 const people = +peopleEl.value;
 const roof = +roofEl.value;
 const panelW = +panelWEl.value;
 const tilt = +tiltEl.value;
 const battSize = +batteryEl.value;
 const manualCons = +manualConsEl.value;
 const lastBill = +lastBillEl.value;

 let baseCons = manualCons || consumoMedio(people); // usa manuale se inserito
 const target = baseCons * 1.2;

 const usableRoof = roof * 0.8; // margine semplice 20%
 const tiltFactor = Math.cos((tilt-30)*Math.PI/180);
 const panelKwp = panelW / 1000;
 const zone = document.getElementById("zone").value;
const zoneYield = ZONE_YIELD[zone];

const kwhPerPanel = panelKwp * zoneYield * tiltFactor;


 const maxPanelsRoof = Math.floor(usableRoof / PANEL_AREA);
 const panelsByEnergy = Math.ceil(target / kwhPerPanel);
 const panels = Math.min(maxPanelsRoof, panelsByEnergy);

 const kwp = panels * panelKwp;
 const production = kwp * zoneYield * tiltFactor;

 const areaUsed = panels * PANEL_AREA;
 const areaPerc = Math.round(areaUsed / roof * 100);

 const dailyCons = baseCons / 365;
 const nightCons = dailyCons * 0.45;
 const battNeeded = nightCons / 0.8;

let battNum = 0;
let battCap = 0;

if(battSize > 0){
   battNum = Math.max(1, Math.ceil(battNeeded / battSize));
   battCap = battNum * battSize;
}

 // RISPARMIO
 let savedKwh = Math.min(baseCons, production * SELF_CONSUMPTION);
 let savedEuro;
 if(lastBill) {
   const avgCostPerKwh = lastBill / baseCons;
   savedEuro = savedKwh * avgCostPerKwh;
 } else {
   savedEuro = savedKwh * ENERGY_COST;
 }
 const investment = kwp*COST_FV_KWP + battCap*COST_BATT_KWH;
 const payback = investment / savedEuro;

let roofWarning = "";
if (panels < panelsByEnergy) {
    const areaNeeded = panelsByEnergy * PANEL_AREA;
    roofWarningBox.style.display = "block";
    roofWarningBox.innerHTML = `
‚ö†Ô∏è Attenzione: la superficie tetto disponibile non √® sufficiente a coprire i consumi stimati. 
Il simulatore installa solo ${panels} pannelli (${areaUsed} m¬≤), mentre ne servirebbero ${panelsByEnergy} pannelli (${areaNeeded} m¬≤) per coprire interamente il fabbisogno stimato.`;
} else {
    roofWarningBox.style.display = "none";
}



 // OUTPUT
 panelsEl.innerText = panels;
 areaUsedEl.innerText = areaUsed+" m¬≤";
 kwpEl.innerText = kwp.toFixed(2)+" kWp";
 prodEl.innerText = Math.round(production)+" kWh";
 areaPercEl.innerText = areaPerc+"%";
 battNumEl.innerText = battNum;
 battCapEl.innerText = battCap+" kWh";
 saveEuroEl.innerText = "‚Ç¨ "+Math.round(savedEuro);
 paybackEl.innerText = payback.toFixed(1)+" anni";


 // CALCOLI DETTAGLIATI
 calcBox.innerHTML = `
 
<em>‚ö†Ô∏è Attenzione: i risultati mostrati hanno valore puramente indicativo. Non costituiscono un‚Äôofferta vincolante n√© una proposta commerciale. Consultare sempre un tecnico qualificato per progettazione e preventivi reali.</em>
<br><br>

${roofWarning ? `<b>${roofWarning}</b><br><br>` : ""}

<b>1Ô∏è‚É£ Consumi</b><br>
‚Ä¢ Persone: ${people}<br>
‚Ä¢ Consumo base stimato: ${baseCons.toFixed(0)} kWh/anno<br>
‚Ä¢ Margine +20%: ${Math.round(target)} kWh/anno<br><br>

<b>2Ô∏è‚É£ Tetto</b><br>
‚Ä¢ Superficie totale: ${roof} m¬≤<br>
‚Ä¢ Superficie utilizzabile (80%): ${usableRoof.toFixed(1)} m¬≤<br><br>

<b>3Ô∏è‚É£ Pannelli</b><br>
‚Ä¢ Area singolo pannello: ${PANEL_AREA} m¬≤<br>
‚Ä¢ Pannelli max su tetto: ${maxPanelsRoof}<br>
‚Ä¢ Produzione singolo pannello: ${panelW} W √ó ${SPECIFIC_YIELD} √ó ${tiltFactor.toFixed(2)} = ${kwhPerPanel.toFixed(0)} kWh/anno<br>
‚Ä¢ Pannelli richiesti dal fabbisogno: ${panelsByEnergy}<br>
‚Ä¢ Pannelli installati: ${panels}<br>
‚Ä¢ Area totale occupata: ${areaUsed} m¬≤<br><br>

<b>4Ô∏è‚É£ Impianto</b><br>
‚Ä¢ Potenza totale: ${kwp.toFixed(2)} kWp<br>
‚Ä¢ Produzione annua totale: ${Math.round(production)} kWh<br><br>

<b>5Ô∏è‚É£ Accumulo</b><br>
‚Ä¢ Consumo giornaliero medio: ${dailyCons.toFixed(2)} kWh<br>
‚Ä¢ Quota notturna (45%): ${nightCons.toFixed(2)} kWh<br>
‚Ä¢ Batteria necessaria: ${battNeeded.toFixed(2)} kWh<br>
‚Ä¢ Batteria scelta: ${battSize} kWh<br>
‚Ä¢ Batterie installate: ${battNum}<br><br>

<b>6Ô∏è‚É£ Risparmio</b><br>
‚Ä¢ Energia autoconsumata: ${Math.round(savedKwh)} kWh<br>
‚Ä¢ Risparmio annuo stimato: ‚Ç¨ ${Math.round(savedEuro)}<br>
‚Ä¢ Investimento stimato: ‚Ç¨ ${Math.round(investment)}<br>
‚Ä¢ Rientro: ${payback.toFixed(1)} anni

`;

 goStep(3);
}

// ELEMENTI
const peopleEl = document.getElementById("people");
const roofEl = document.getElementById("roof");
const manualConsEl = document.getElementById("manualCons");
const lastBillEl = document.getElementById("lastBill");
const panelWEl = document.getElementById("panelW");
const tiltEl = document.getElementById("tilt");
const batteryEl = document.getElementById("battery");
const roofWarningBox = document.getElementById("roofWarningBox");

const panelsEl = document.getElementById("panels");
const areaUsedEl = document.getElementById("areaUsed");
const kwpEl = document.getElementById("kwp");
const prodEl = document.getElementById("prod");
const areaPercEl = document.getElementById("areaPerc");
const battNumEl = document.getElementById("battNum");
const battCapEl = document.getElementById("battCap");
const saveEuroEl = document.getElementById("saveEuro");
const paybackEl = document.getElementById("payback");
const calcBox = document.getElementById("calcBox");
</script>

</body>
</html>
